

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/icon.jpeg">
  <link rel="icon" href="/images/icon.jpeg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Mehrdad Karami">
  <meta name="keywords" content="Java,SpringBoot, Kafka, Kafka Streams, Software Architecture, Best code practices">
  
    <meta name="description" content="On September 14, 2021 the time had finally come: After the five “intermediate versions” Java 12 to 15, each of which was only maintained for half a year, the current long-term support (LTS) release,">
<meta property="og:type" content="article">
<meta property="og:title" content="What&#39;s new in Java 17">
<meta property="og:url" content="https://java-springboot-kafka.github.io/2022/11/13/what_is_new_in_java_17/index.html">
<meta property="og:site_name" content="Java SpringBoot Kafka Best code practices">
<meta property="og:description" content="On September 14, 2021 the time had finally come: After the five “intermediate versions” Java 12 to 15, each of which was only maintained for half a year, the current long-term support (LTS) release,">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://res.infoq.com/articles/why-how-upgrade-java17/en/headerimage/upgrade-to-java-16-or-17-header-image-1630333858357.jpg">
<meta property="og:image" content="https://www.happycoders.eu/wp-content/uploads/2021/12/random_number_generators_pre_java17-600x249.png">
<meta property="og:image" content="https://www.happycoders.eu/wp-content/uploads/2021/12/random_number_generators_java17-800x438.png">
<meta property="og:image" content="https://www.happycoders.eu/wp-content/uploads/2021/12/javadoc_since_java_17-800x503.png">
<meta property="og:image" content="https://www.happycoders.eu/wp-content/uploads/2021/12/javadoc_deprecated_java_16-800x435.png">
<meta property="og:image" content="https://www.happycoders.eu/wp-content/uploads/2021/12/javadoc_deprecated_java_17-800x460.png">
<meta property="article:published_time" content="2022-11-13T18:22:19.203Z">
<meta property="article:modified_time" content="2022-11-13T18:27:54.256Z">
<meta property="article:author" content="Mehrdad Karami">
<meta property="article:tag" content="Java,SpringBoot, Kafka, Kafka Streams, Software Architecture, Best code practices">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://res.infoq.com/articles/why-how-upgrade-java17/en/headerimage/upgrade-to-java-16-or-17-header-image-1630333858357.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>What&#39;s new in Java 17 - Java SpringBoot Kafka Best code practices</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"java-springboot-kafka.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"Java"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/images/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Mehrdad Karami</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/images/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="What&#39;s new in Java 17"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Mehrdad Karami
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-11-13 19:22" pubdate>
          November 13, 2022 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          30k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          248 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">What&#39;s new in Java 17</h1>
            
              <p class="note note-info">
                
                  
                    Last updated on November 13, 2022 pm
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p><img src="https://res.infoq.com/articles/why-how-upgrade-java17/en/headerimage/upgrade-to-java-16-or-17-header-image-1630333858357.jpg" srcset="/images/loading.gif" lazyload alt="java17"></p>
<p>On September 14, 2021 the time had finally come: After the five “intermediate versions” Java 12 to 15, each of which was only maintained for half a year, the current long-term support (LTS) release, Java 17, was released.</p>
<p>Oracle will provide free upgrades for Java 17 for at least five years, i.e. until September 2026 - and extended, paid support until September 2029.</p>
<p>In Java 17, 14 JDK enhancement proposals were implemented. I sorted the changes by relevance to day-to-day programming work. The article begins with language enhancements and changes to the module system. Various extensions of the JDK class library follow, performance improvements, new preview and incubator features, deprecations and deletions and finally other changes that are rarely encountered in day-to-day work.</p>
<p>As always, I have used the English names of the JEPs and other changes. A translation into German would not bring any added value here.</p>
<h2 id="Sealed-Classes"><a href="#Sealed-Classes" class="headerlink" title="Sealed Classes"></a>Sealed Classes</h2><p>The big innovation in Java 17 (besides long-term support) are sealed classes and interfaces.</p>
<p>What sealed classes are, exactly how they work and why we need them, I will explain in a separate article due to the scope of the topic: <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/sealed-classes-de/">Sealed Classes in Java</a></p>
<p><em>(Sealed classes were first introduced in <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-15-features-de/#Sealed_Classes_Preview">Java 15</a> as a preview feature. Three small changes were released in <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-16-features-de/#Sealed_Classes_Second_Preview">Java 16.</a> <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/409">JDK Enhancement Proposal 409</a> declares sealed classes production-ready in Java 17 with no further changes.)</em></p>
<h2 id="Strongly-Encapsulate-JDK-Internals"><a href="#Strongly-Encapsulate-JDK-Internals" class="headerlink" title="Strongly Encapsulate JDK Internals"></a>Strongly Encapsulate JDK Internals</h2><p>The module system ( <a target="_blank" rel="noopener" href="https://openjdk.org/projects/jigsaw/">Project Jigsaw</a> ) was introduced in Java 9, in particular to be able to better modularize code and to increase the security of the Java platform.</p>
<h3 id="Before-Java-16-Relaxed-Strong-Encapsulation"><a href="#Before-Java-16-Relaxed-Strong-Encapsulation" class="headerlink" title="Before Java 16: Relaxed Strong Encapsulation"></a>Before Java 16: Relaxed Strong Encapsulation</h3><p>Up until Java 16, this had little impact on existing code, as the JDK developers provided “Relaxed Strong Encapsulation” mode for a transitional period.</p>
<p>This allowed non-public classes and methods of packages in the JDK class library that existed before Java 9 to be accessed via deep reflection without changing the configuration.</p>
<p>The following example extracts the bytes of a string by reading its private field <code>value</code>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EncapsulationTest</span> &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) throws ReflectiveOperationException</span> &#123;<br>    <span class="hljs-built_in">byte</span>[] <span class="hljs-keyword">value</span> = getValue(<span class="hljs-string">&quot;Happy Coding!&quot;</span>);<br>    System.<span class="hljs-keyword">out</span>.println(Arrays.toString(<span class="hljs-keyword">value</span>));<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">byte</span>[] <span class="hljs-title">getValue</span>(<span class="hljs-params">String <span class="hljs-built_in">string</span></span>) throws ReflectiveOperationException</span> &#123;<br>    Field VALUE = String.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">&quot;value&quot;</span>);<br>    VALUE.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">byte</span>[]) VALUE.<span class="hljs-keyword">get</span>(<span class="hljs-built_in">string</span>);<br>  &#125;<br>&#125;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>If we call this program with Java 9 to 15, we get the following output:</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ java EncapsulationTest.java<br><span class="hljs-symbol">WARNING: </span>An illegal reflective access operation has occurred<br><span class="hljs-symbol">WARNING: </span>Illegal reflective access by EncapsulationTest (file:/.../EncapsulationTest.java) to field java.lang.String.value<br><span class="hljs-symbol">WARNING: </span>Please consider reporting this to the maintainers of EncapsulationTest<br><span class="hljs-symbol">WARNING: </span>Use --illegal-access=warn to enable warnings of further illegal reflective access operations<br><span class="hljs-symbol">WARNING: </span>All illegal access operations will be denied in a future release<br><span class="hljs-meta">[72, 97, 112, 112, 121, 32, 67, 111, 100, 105, 110, 103, 33]</span><br>Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>We see some warnings, but then we get the desired bytes.</p>
<p>Deep reflection on <em>new</em> packages, on the other hand, was not allowed by default and had to be explicitly allowed on the command line with “–add-opens” since the introduction of the module system.</p>
<p>The following example tries to instantiate the class <code>ConstantDescs</code>from the package added in Java 12 (i.e. after the introduction of the module system) <code>java.lang.constant</code>via its private constructor:</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">Constructor</span>&lt;<span class="hljs-title function_">ConstantDescs</span>&gt; <span class="hljs-title function_">constructor</span> = <span class="hljs-title function_">ConstantDescs</span>.<span class="hljs-title function_">class</span>.<span class="hljs-title function_">getDeclaredConstructor</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">constructor</span>.setAccessible(<span class="hljs-keyword">true</span>)<span class="hljs-punctuation">;</span><br>ConstantDescs constantDescs = <span class="hljs-keyword">constructor</span>.newInstance()<span class="hljs-punctuation">;</span><br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>The program aborts with the following error message:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ java ConstantDescsTest<span class="hljs-selector-class">.java</span><br>Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.InaccessibleObjectException</span>: Unable to make private java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.constant</span><span class="hljs-selector-class">.ConstantDescs</span>() accessible: module java<span class="hljs-selector-class">.base</span> does not <span class="hljs-string">&quot;opens java.lang.constant&quot;</span> to unnamed module @<span class="hljs-number">6</span>c3f5566<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.AccessibleObject</span><span class="hljs-selector-class">.checkCanSetAccessible</span>(AccessibleObject<span class="hljs-selector-class">.java</span>:<span class="hljs-number">361</span>)<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.AccessibleObject</span><span class="hljs-selector-class">.checkCanSetAccessible</span>(AccessibleObject<span class="hljs-selector-class">.java</span>:<span class="hljs-number">301</span>)<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.Constructor</span><span class="hljs-selector-class">.checkCanSetAccessible</span>(Constructor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">189</span>)<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.Constructor</span><span class="hljs-selector-class">.setAccessible</span>(Constructor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">182</span>)<br>        at ConstantDescsTest<span class="hljs-selector-class">.main</span>(ConstantDescsTest<span class="hljs-selector-class">.java</span>:<span class="hljs-number">7</span>)<br>Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>In order to make the program runnable, we need to <code>--add-opens</code>open via the new package for Deep Reflection:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ <span class="hljs-keyword">java </span>--<span class="hljs-keyword">add-opens </span><span class="hljs-keyword">java.base/java.lang.constant=ALL-UNNAMED </span>ConstantDescsTest.<span class="hljs-keyword">java</span><br><span class="hljs-keyword"></span>Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>The code then runs error-free and without warnings.</p>
<h3 id="Since-Java-16-Default-Strong-Encapsulation-Optional-Relaxed-Strong-Encapsulation"><a href="#Since-Java-16-Default-Strong-Encapsulation-Optional-Relaxed-Strong-Encapsulation" class="headerlink" title="Since Java 16: Default Strong Encapsulation + Optional Relaxed Strong Encapsulation"></a>Since Java 16: Default Strong Encapsulation + Optional Relaxed Strong Encapsulation</h3><p>In <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-16-features-de/#Strongly_Encapsulate_JDK_Internals_by_Default">Java 16</a> , the default mode was changed from “Relaxed Strong Encapsulation” to “Strong Encapsulation”. Since then, access to pre-Java 9 packages has also had to be explicitly allowed.</p>
<p>If we run the first example on Java 16 without explicitly allowing access, we get the following error message:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ java EncapsulationTest<span class="hljs-selector-class">.java</span><br>Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.InaccessibleObjectException</span>: Unable to make field private final byte<span class="hljs-selector-attr">[]</span> java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.String</span><span class="hljs-selector-class">.value</span> accessible: module java<span class="hljs-selector-class">.base</span> does not <span class="hljs-string">&quot;opens java.lang&quot;</span> to unnamed module @<span class="hljs-number">62</span>fdb4a6<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.AccessibleObject</span><span class="hljs-selector-class">.checkCanSetAccessible</span>(AccessibleObject<span class="hljs-selector-class">.java</span>:<span class="hljs-number">357</span>)<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.AccessibleObject</span><span class="hljs-selector-class">.checkCanSetAccessible</span>(AccessibleObject<span class="hljs-selector-class">.java</span>:<span class="hljs-number">297</span>)<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.Field</span><span class="hljs-selector-class">.checkCanSetAccessible</span>(Field<span class="hljs-selector-class">.java</span>:<span class="hljs-number">177</span>)<br>        at java.base/java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.Field</span><span class="hljs-selector-class">.setAccessible</span>(Field<span class="hljs-selector-class">.java</span>:<span class="hljs-number">171</span>)<br>        at EncapsulationTest<span class="hljs-selector-class">.getValue</span>(EncapsulationTest<span class="hljs-selector-class">.java</span>:<span class="hljs-number">12</span>)<br>        at EncapsulationTest<span class="hljs-selector-class">.main</span>(EncapsulationTest<span class="hljs-selector-class">.java</span>:<span class="hljs-number">6</span>)<br>Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>However, Java 16 offered a workaround: You <code>--illegal-access=permit</code>could switch back to “Relaxed Strong Encapsulation” using the VM option:</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">$ java --illegal-access=permit EncapsulationTest.java<br>Java HotSpot(TM) 64-Bit Server VM warning: Option --illegal-access is deprecated and will be removed in a future release.<br><span class="hljs-symbol">WARNING: </span>An illegal reflective access operation has occurred<br><span class="hljs-symbol">WARNING: </span>Illegal reflective access by EncapsulationTest (file:/.../EncapsulationTest.java) to field java.lang.String.value<br><span class="hljs-symbol">WARNING: </span>Please consider reporting this to the maintainers of EncapsulationTest<br><span class="hljs-symbol">WARNING: </span>Use --illegal-access=warn to enable warnings of further illegal reflective access operations<br><span class="hljs-symbol">WARNING: </span>All illegal access operations will be denied in a future release<br><span class="hljs-meta">[72, 97, 112, 112, 121, 32, 67, 111, 100, 105, 110, 103, 33]</span><br>Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<h3 id="Since-Java-17-Strong-encapsulation-only"><a href="#Since-Java-17-Strong-encapsulation-only" class="headerlink" title="Since Java 17: Strong encapsulation only"></a>Since Java 17: Strong encapsulation only</h3><p>Per <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/403">JDK Enhancement Proposal 403</a> , this option will be removed from Java 17. The VM option <code>--illegal-access</code>has been warned and inaccessible by <code>String.value</code>default:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">java --illegal-access=permit <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EncapsulationTest</span>.</span></span>java<br>OpenJDK <span class="hljs-number">64</span>-Bit Server VM warning: Ignoring option --illegal-access=permit; support was removed <span class="hljs-keyword">in</span> <span class="hljs-number">17.0</span><br>Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java.lang.reflect.InaccessibleObjectException: Unable <span class="hljs-keyword">to</span> make field <span class="hljs-keyword">private</span> final byte<span class="hljs-literal">[]</span> java.lang.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">String</span>.</span></span>value accessible: <span class="hljs-keyword">module</span> java.base does not <span class="hljs-string">&quot;opens java.lang&quot;</span> <span class="hljs-keyword">to</span> unnamed <span class="hljs-keyword">module</span> @<span class="hljs-number">3e77</span>a1ed<br>        at java.base/java.lang.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AccessibleObject</span>.</span></span>check<span class="hljs-constructor">CanSetAccessible(AccessibleObject.<span class="hljs-params">java</span>:354)</span><br>        at java.base/java.lang.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AccessibleObject</span>.</span></span>check<span class="hljs-constructor">CanSetAccessible(AccessibleObject.<span class="hljs-params">java</span>:297)</span><br>        at java.base/java.lang.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Field</span>.</span></span>check<span class="hljs-constructor">CanSetAccessible(Field.<span class="hljs-params">java</span>:178)</span><br>        at java.base/java.lang.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Field</span>.</span></span>set<span class="hljs-constructor">Accessible(Field.<span class="hljs-params">java</span>:172)</span><br>        at <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EncapsulationTest</span>.</span></span>get<span class="hljs-constructor">Value(EncapsulationTest.<span class="hljs-params">java</span>:12)</span><br>        at <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EncapsulationTest</span>.</span></span>main(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EncapsulationTest</span>.</span></span>java:<span class="hljs-number">6</span>)<br>Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>If you want to use Deep Reflection from Java 17, you must now explicitly <code>--add-opens</code>allow it:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ <span class="hljs-keyword">java </span>--<span class="hljs-keyword">add-opens </span><span class="hljs-keyword">java.base/java.lang=ALL-UNNAMED </span>EncapsulationTest.<span class="hljs-keyword">java</span><br><span class="hljs-keyword"></span>[<span class="hljs-number">72</span>, <span class="hljs-number">97</span>, <span class="hljs-number">112</span>, <span class="hljs-number">112</span>, <span class="hljs-number">121</span>, <span class="hljs-number">32</span>, <span class="hljs-number">67</span>, <span class="hljs-number">111</span>, <span class="hljs-number">100</span>, <span class="hljs-number">105</span>, <span class="hljs-number">110</span>, <span class="hljs-number">103</span>, <span class="hljs-number">33</span>]<br>Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>The program is running and we no longer see any warnings - the long transition phase since Java 9 has thus been completed.</p>
<h2 id="Add-java-time-InstantSource"><a href="#Add-java-time-InstantSource" class="headerlink" title="Add java.time.InstantSource"></a>Add java.time.InstantSource</h2><p>The class <code>java.time.Clock</code>is extremely useful for writing tests that verify time-dependent functionality.</p>
<p>if <code>Clock</code>e.g. B. is injected into the application classes via dependency injection, you can mock them in tests or <code>Clock.fixed()</code>set a fixed time for the test execution.</p>
<p>Since <code>Clock</code>the method <code>getZone()</code>provides, you always have to think about which specific time zone you <code>Clock</code>instantiate an object with.</p>
<p>In order to enable alternative, time zone-independent time sources, the interface <code>java.time.InstantSource</code>from was <code>Clock</code>extracted in Java 17, which only provides the methods <code>instant()</code>and for querying the time, which is already implemented as a default method.<code>millis()``millis()</code></p>
<p>The <code>Timer</code>class in the following example uses <code>InstantSource</code>to determine the start and end times of an <code>Runnable</code>execution and calculate the duration of the execution from that:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">public class Timer &#123;<br>  private final <span class="hljs-keyword">InstantSource </span><span class="hljs-keyword">instantSource;</span><br><span class="hljs-keyword"></span><br>  public Timer(<span class="hljs-keyword">InstantSource </span><span class="hljs-keyword">instantSource) </span>&#123;<br>    this.<span class="hljs-keyword">instantSource </span>= <span class="hljs-keyword">instantSource;</span><br><span class="hljs-keyword"></span>  &#125;<br><br>  public Duration measure(Runnable runnable) &#123;<br>    <span class="hljs-keyword">Instant </span>start = <span class="hljs-keyword">instantSource.instant();</span><br><span class="hljs-keyword"></span>    runnable.run();<br>    <span class="hljs-keyword">Instant </span>end = <span class="hljs-keyword">instantSource.instant();</span><br><span class="hljs-keyword"></span>    return Duration.<span class="hljs-keyword">between(start, </span>end);<br>  &#125;<br>&#125;<br>Code language:  <span class="hljs-keyword">Java </span> ( <span class="hljs-keyword">java </span>)<br></code></pre></td></tr></table></figure>

<p>In production we can <code>Timer</code>instantiate using the system clock (although in the absence of alternative implementations we have to <code>InstantSource</code>worry about the timezone - we’ll use the system’s default timezone):</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">Timer timer = new Timer(<span class="hljs-keyword">Clock.systemDefaultZone());Code </span>language:  <span class="hljs-keyword">Java </span> ( <span class="hljs-keyword">java </span>)<br></code></pre></td></tr></table></figure>

<p>We can test the <code>measure()</code>method by <code>InstantSource</code>mocking its <code>instant()</code>method to return two fixed values and comparing the return value of <code>measure()</code>with the difference between these values:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Test<br>void should<span class="hljs-constructor">ReturnDurationBetweenStartAndEnd()</span> &#123;<br>  InstantSource instantSource = mock(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InstantSource</span>.</span></span><span class="hljs-keyword">class</span>);<br>  <span class="hljs-keyword">when</span>(instantSource.instant<span class="hljs-literal">()</span>)<br>      .<span class="hljs-keyword">then</span><span class="hljs-constructor">Return(Instant.<span class="hljs-params">ofEpochMilli</span>(1_640_033_566_000L)</span>)<br>      .<span class="hljs-keyword">then</span><span class="hljs-constructor">Return(Instant.<span class="hljs-params">ofEpochMilli</span>(1_640_033_567_750L)</span>);<br><br>  Timer timer = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Timer(<span class="hljs-params">instantSource</span>)</span>;<br>  Duration duration = timer.measure(<span class="hljs-literal">()</span> -&gt; &#123;&#125;);<br><br>  <span class="hljs-keyword">assert</span><span class="hljs-constructor">That(<span class="hljs-params">duration</span>, <span class="hljs-params">is</span>(Duration.<span class="hljs-params">ofMillis</span>(1_750)</span>));<br>&#125;Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p><em>There is no JDK Enhancement Proposal for this extension.</em></p>
<h2 id="Hex-Formatting-and-Parsing-Utility"><a href="#Hex-Formatting-and-Parsing-Utility" class="headerlink" title="Hex Formatting and Parsing Utility"></a>Hex Formatting and Parsing Utility</h2><p>Until now, we could use – or use – the <code>toHexString()</code>method of the classes <code>Integer</code>, <code>Long</code>, <code>Float</code>and to output hexadecimal numbers . The following code shows a few examples:<code>Double``String.format()</code></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">HexString(1_000)</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Long</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">HexString(100_000_000_000L)</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Float</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">HexString(3.14F)</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Double</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">HexString(3.14159265359)</span>);<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<br>    <span class="hljs-string">&quot;%x - %x - %a - %a&quot;</span>.formatted(<span class="hljs-number">1_000</span>, <span class="hljs-number">100_000_000_000L</span>, <span class="hljs-number">3.14</span>F, <span class="hljs-number">3.14159265359</span>));Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>The code results in the following output:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">3e8</span><br><span class="hljs-attribute">174876e800</span><br><span class="hljs-attribute">0x1</span>.<span class="hljs-number">91</span>eb86p1<br><span class="hljs-attribute">0x1</span>.<span class="hljs-number">921</span>fb54442eeap1<br><span class="hljs-attribute">3e8</span> - <span class="hljs-number">174876</span>e800 - <span class="hljs-number">0</span>x1.<span class="hljs-number">91</span>eb86p1 - <span class="hljs-number">0</span>x1.<span class="hljs-number">921</span>fb54442eeap1Code language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>We could parse hexadecimal numbers with the respective counterparts:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Integer</span>.</span></span>parse<span class="hljs-constructor">Int(<span class="hljs-string">&quot;3e8&quot;</span>, 16)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Long</span>.</span></span>parse<span class="hljs-constructor">Long(<span class="hljs-string">&quot;174876e800&quot;</span>, 16)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Float</span>.</span></span>parse<span class="hljs-constructor">Float(<span class="hljs-string">&quot;0x1.91eb86p1&quot;</span>)</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Double</span>.</span></span>parse<span class="hljs-constructor">Double(<span class="hljs-string">&quot;0x1.921fb54442eeap1&quot;</span>)</span>;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>Java 17 provides the new class <code>java.util.HexFormat</code>that is used to represent and parse hexadecimal numbers via a unified API. <code>HexFormat</code>supports all primitive integers ( <code>int</code>, <code>byte</code>, <code>char</code>, <code>long</code>, <code>short</code>) and <code>byte</code>arrays – but no floating point numbers.</p>
<p>Here is an example of the conversion to hexadecimal numbers:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">HexFormat hexFormat = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HexFormat</span>.</span></span><span class="hljs-keyword">of</span><span class="hljs-literal">()</span>;<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(hexFormat.<span class="hljs-keyword">to</span><span class="hljs-constructor">HexDigits(&#x27;A&#x27;)</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(hexFormat.<span class="hljs-keyword">to</span><span class="hljs-constructor">HexDigits((<span class="hljs-params">byte</span>)</span> <span class="hljs-number">10</span>));<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(hexFormat.<span class="hljs-keyword">to</span><span class="hljs-constructor">HexDigits((<span class="hljs-params">short</span>)</span> <span class="hljs-number">1_000</span>));<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(hexFormat.<span class="hljs-keyword">to</span><span class="hljs-constructor">HexDigits(1_000_000)</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(hexFormat.<span class="hljs-keyword">to</span><span class="hljs-constructor">HexDigits(100_000_000_000L)</span>);<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(hexFormat.format<span class="hljs-constructor">Hex(<span class="hljs-params">new</span> <span class="hljs-params">byte</span>[] &#123;1, 2, 3, 60, 126, -1&#125;)</span>);Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>The output is:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-number">0041</span><br><span class="hljs-string">0a</span><br><span class="hljs-number">03e8</span><br><span class="hljs-string">000f4240</span><br><span class="hljs-number">000000174876e800</span><br><span class="hljs-attr">0102033c7effCode language:</span>  <span class="hljs-string">Plaintext</span>  <span class="hljs-string">(</span> <span class="hljs-string">plaintext</span> <span class="hljs-string">)</span><br></code></pre></td></tr></table></figure>

<p>It is noticeable that the output always comes with leading zeros.</p>
<p>The representation we can z. B. adjust as follows:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">HexFormat hexFormat = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HexFormat</span>.</span></span><span class="hljs-keyword">of</span><span class="hljs-constructor">Delimiter(<span class="hljs-string">&quot; &quot;</span>)</span>.<span class="hljs-keyword">with</span><span class="hljs-constructor">Prefix(<span class="hljs-string">&quot;0x&quot;</span>)</span>.<span class="hljs-keyword">with</span><span class="hljs-constructor">UpperCase()</span>;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<ul>
<li><code>ofDelimiter()</code>Specifies a delimiter for formatting byte arrays.</li>
<li><code>withPrefix()</code>defines a prefix – but only for byte arrays!</li>
<li><code>withUpperCase()</code>switches the output to uppercase.</li>
</ul>
<p>The output is now:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0041</span><br><span class="hljs-attribute">0A</span><br><span class="hljs-attribute">03E8</span><br><span class="hljs-attribute">000F4240</span><br><span class="hljs-attribute">000000174876E800</span><br><span class="hljs-attribute">0x01</span> <span class="hljs-number">0</span>x02 <span class="hljs-number">0</span>x03 <span class="hljs-number">0</span>x3C <span class="hljs-number">0</span>x7E <span class="hljs-number">0</span>xFFCode language:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<p>The leading zeros cannot be removed.</p>
<p>We can parse integers as follows:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-built_in">int</span> i = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HexFormat</span>.</span></span>from<span class="hljs-constructor">HexDigits(<span class="hljs-string">&quot;F4240&quot;</span>)</span>;<br>long l = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HexFormat</span>.</span></span>from<span class="hljs-constructor">HexDigitsToLong(<span class="hljs-string">&quot;174876E800&quot;</span>)</span>;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>Corresponding methods for <code>char</code>, <code>byte</code>and <code>short</code>do not exist.</p>
<p>We can parse byte arrays e.g. B. as follows:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">HexFormat hexFormat = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HexFormat</span>.</span></span><span class="hljs-keyword">of</span><span class="hljs-constructor">Delimiter(<span class="hljs-string">&quot; &quot;</span>)</span>.<span class="hljs-keyword">with</span><span class="hljs-constructor">Prefix(<span class="hljs-string">&quot;0x&quot;</span>)</span>.<span class="hljs-keyword">with</span><span class="hljs-constructor">UpperCase()</span>;<br>byte<span class="hljs-literal">[]</span> <span class="hljs-built_in">bytes</span> = hexFormat.parse<span class="hljs-constructor">Hex(<span class="hljs-string">&quot;0x01 0x02 0x03 0x3C 0x7E 0xFF&quot;</span>)</span>;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>There are other methods to B. to parse only a substring. <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/HexFormat.html">See the HexFormat JavaDoc for</a> full documentation .</p>
<p><em>There is no JDK Enhancement Proposal for this extension.</em></p>
<h2 id="Context-Specific-Deserialization-Filters"><a href="#Context-Specific-Deserialization-Filters" class="headerlink" title="Context-Specific Deserialization Filters"></a>Context-Specific Deserialization Filters</h2><p>Object deserialization poses a significant security risk. Malicious attackers can use the data stream to be deserialized to construct objects, through which they can ultimately execute arbitrary code in arbitrary classes (available on the classpath).</p>
<p>Java 9 introduced deserialization filters, the ability to specify which classes may (or may not) be deserialized.</p>
<p>Previously there were two ways to define deserialization filters:</p>
<ul>
<li>per <code>ObjectInputStream.setObjectInputFilter()</code>for each deserialization separately,</li>
<li>system-wide uniformly via system property <code>jdk.serialFilter</code>or via security property of the same name in the file <code>conf/security/java.properties</code>.</li>
</ul>
<p>For complex applications, especially those with third-party libraries that also contain deserialization code, these variants are not satisfactory. For example, deserialization in third-party code cannot be <code>ObjectInputStream.setObjectInputFilter()</code>configured via (unless you change their source code), but only globally.</p>
<p><a target="_blank" rel="noopener" href="https://openjdk.org/jeps/415">As of Java 17, JDK Enhancement Proposal 415</a> makes it possible to set context-specific deserialization filters, e.g. B. for a specific thread or based on the call stack for a specific class, module, or third-party library.</p>
<p>The configuration of the filters is not easy and would go beyond the scope of this article. Details can be found in the JEP linked above.</p>
<h3 id="JDK-Flight-Recorder-Event-for-Deserialization"><a href="#JDK-Flight-Recorder-Event-for-Deserialization" class="headerlink" title="JDK Flight Recorder Event for Deserialization"></a>JDK Flight Recorder Event for Deserialization</h3><p>As of Java 17 it is also possible to monitor the deserialization of objects via the JDK Flight Recorder (JFR).</p>
<p>Deserialization events are disabled by default and must be enabled via the event identifier <code>jdk.Deserialization</code>in the JFR configuration file (see the article linked below for an example).</p>
<p>If a deserialization filter is activated, the JFR event contains an indication of whether the deserialization was executed or rejected.</p>
<p>For more detailed information and an example, see the article “ <a target="_blank" rel="noopener" href="https://inside.java/2021/03/02/monitoring-deserialization-activity-in-the-jdk/">Monitoring Deserialization to Improve Application Security</a> “.</p>
<p><em>The Flight Recorder events for the deserialization are not part of the above JDK Enhancement Proposal; there is also no separate JEP for them.</em></p>
<h2 id="Enhanced-Pseudo-Random-Number-Generators"><a href="#Enhanced-Pseudo-Random-Number-Generators" class="headerlink" title="Enhanced Pseudo-Random Number Generators"></a>Enhanced Pseudo-Random Number Generators</h2><p>Until now, it has been tedious to replace the <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/zufallszahl/">random number-generating</a> classes <code>Random</code>and <code>SplittableRandom</code>in an application (or even to replace them with other algorithms) even though they offer a largely identical set of methods (e.g. <code>nextInt()</code>, <code>nextDouble()</code>and stream-generating methods such as <code>ints()</code>and <code>longs()</code>).</p>
<p>So far, the class hierarchy looked like this:</p>
<p><img src="https://www.happycoders.eu/wp-content/uploads/2021/12/random_number_generators_pre_java17-600x249.png" srcset="/images/loading.gif" lazyload alt="Pre-Java 17 Pseudo-Random Number Generators"></p>
<p>Pre-Java 17 Pseudo-Random Number Generators</p>
<p>JDK <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/356">Enhancement Proposal 356</a> introduced a framework of inheriting interfaces for the existing and new algorithms in Java 17, so that the concrete algorithms can easily be exchanged in the future:</p>
<p><img src="https://www.happycoders.eu/wp-content/uploads/2021/12/random_number_generators_java17-800x438.png" srcset="/images/loading.gif" lazyload alt="Java 17 Pseudo-Random Number Generators"></p>
<p>Java 17 Pseudo-Random Number Generators</p>
<p>The methods common to all random number generators such as <code>nextInt()</code>and <code>nextDouble()</code>are <code>RandomGenerator</code>defined in . If you only need these methods, you should always use this interface in the future.</p>
<p>The framework includes three new types of random number generators:</p>
<ul>
<li><code>JumpableGenerator</code>: provides methods to skip a large number of random numbers (e.g. 2 <sup><span><span>64 ).</span></span></sup></li>
<li><code>LeapableGenerator</code>: provides methods to skip a <em>very</em> large number of random numbers (e.g. 2 <sup><span><span>128 ).</span></span></sup></li>
<li><code>ArbitrarilyJumpableGenerator</code>: provides additional methods to skip <em>any</em> number of random numbers.</li>
</ul>
<p>Also, code duplicated in the existing classes has been eliminated and code has been extracted into non-public abstract classes (not visible in the class diagram) to make it reusable for future random number generator implementations.</p>
<p><code>RandomGeneratorFactory</code>New random number generators can be added and instantiated via the Service Provider Interface (SPI) in the future .</p>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><p>With asynchronous logging, Java 17 brings a long-overdue performance improvement to the Unified JVM logging system introduced in Java 9.</p>
<h3 id="Unified-Logging-Supports-Asynchronous-Log-Flushing"><a href="#Unified-Logging-Supports-Asynchronous-Log-Flushing" class="headerlink" title="Unified Logging Supports Asynchronous Log Flushing"></a>Unified Logging Supports Asynchronous Log Flushing</h3><p>Asynchronous logging is a feature supported by all Java logging frameworks. The application thread first writes log messages to a queue. A separate I&#x2F;O thread then routes them to the configured output (console, file, or network).</p>
<p>The application thread does not have to wait for the I&#x2F;O subsystem to process the message.</p>
<p>As of Java 17, asynchronous logging can also be activated for the JVM itself. This is done using the following VM option:</p>
<p><code>-Xlog:async</code></p>
<p>The logging queue is limited to a fixed size. If the application sends more log messages than the I&#x2F;O thread can process, the queue fills up. She then rejects further messages without comment.</p>
<p>The size of the queue can be adjusted using the following VM option:</p>
<p><code>-XX:AsyncLogBufferSize=&lt;Bytes&gt;</code></p>
<p><em>There is no JDK Enhancement Proposal for this extension.</em></p>
<h2 id="Preview-and-Incubator-features"><a href="#Preview-and-Incubator-features" class="headerlink" title="Preview and Incubator features"></a>Preview and Incubator features</h2><p>Even though Java 17 is a long-term support (LTS) release, it contains preview and incubator features that are expected to reach production maturity in one of the next “intermediate releases”. If you only use LTS releases, you have to wait at least until Java 23 to use these features.</p>
<h3 id="Pattern-Matching-for-switch-Preview"><a href="#Pattern-Matching-for-switch-Preview" class="headerlink" title="Pattern Matching for switch (Preview)"></a>Pattern Matching for switch (Preview)</h3><p>In Java 16 <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-16-features-de/#Pattern_Matching_for_instanceof">“Pattern Matching for instanceof”</a> was introduced. This made explicit casts after <code>instanceof</code>tests superfluous. This allows e.g. B. Code like the following:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">if</span> (obj instanceof String s) &#123;<br>  <span class="hljs-keyword">if</span> (s.length() &gt; <span class="hljs-number">5</span>) &#123;<br>    <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s.toUpperCase());<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s.toLowerCase());<br>  &#125;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj instanceof <span class="hljs-type">Integer</span> i) &#123;<br>  <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(i * i);<br>&#125;Code <span class="hljs-keyword">language</span>:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>With <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/406">JDK Enhancement Proposal 406</a> , the check whether an object is an instance of a certain class can also be written as a <code>switch</code>statement (or expression) in the future.</p>
<h4 id="Pattern-matching-for-switch-statements"><a href="#Pattern-matching-for-switch-statements" class="headerlink" title="Pattern matching for switch statements"></a>Pattern matching for switch statements</h4><p>Here is the example from above rewritten into a <code>switch</code>statement:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">switch (obj) &#123;<br>  <span class="hljs-keyword">case</span> String s -&gt; &#123;<br>    <span class="hljs-keyword">if</span> (s.length() &gt; <span class="hljs-number">5</span>) &#123;<br>      <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s.toUpperCase());<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s.toLowerCase());<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">case</span> <span class="hljs-type">Integer</span> i -&gt; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(i * i);<br><br>  <span class="hljs-keyword">default</span> -&gt; &#123;&#125;<br>&#125;Code <span class="hljs-keyword">language</span>:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>It is noticeable that the <code>default</code>case must be specified - in this case with an empty code block, since an action should only be carried out for strings and integers.</p>
<p>The code becomes much more readable if we combine <code>case</code>- and - expressions with a logical “and” (this is then called a “guarded pattern”):<code>if</code></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">switch (obj) &#123;<br>  <span class="hljs-keyword">case</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span> -&gt; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s.toUpperCase());<br>  <span class="hljs-keyword">case</span> String s                   -&gt; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s.toLowerCase());<br><br>  <span class="hljs-keyword">case</span> <span class="hljs-type">Integer</span> i                  -&gt; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(i * i);<br><br>  <span class="hljs-keyword">default</span> -&gt; &#123;&#125;<br>&#125;<br>Code <span class="hljs-keyword">language</span>:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>It is important that a so-called “dominant <em>pattern</em> “ must come after a “dominant <em>pattern</em> “. In the example, the shorter pattern from line 3 “String s” dominates the longer one from line 2.</p>
<p>If we swapped these lines, it would look like this:</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">switch</span> (obj) &#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-built_in">String</span> s                   -&gt; System.out.println(s.toLowerCase());<br>  <span class="hljs-keyword">case</span> <span class="hljs-built_in">String</span> s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span> -&gt; System.out.println(s.toUpperCase());<br><br>  ...<br>&#125;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>In this case, the compiler would criticize line 3 with the following error message:</p>
<p><em>Label is dominated by a preceding case label ‘String s’</em></p>
<p>The reason for this is that now every string – no matter what length – is matched by the pattern “String s” (line 2) and doesn’t even get to the second case test (line 3).</p>
<h4 id="Pattern-matching-for-switch-expressions"><a href="#Pattern-matching-for-switch-expressions" class="headerlink" title="Pattern matching for switch expressions"></a>Pattern matching for switch expressions</h4><p>Pattern matching can also be used for <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/switch-expressions/#switch-als-ausdruck-mit-ruckgabewert"><code>switch</code>expressions</a> ( i.e. <code>switch</code>with a return value):</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-built_in">String</span> output = <span class="hljs-keyword">switch</span> (obj) &#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-built_in">String</span> s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span> -&gt; s.toUpperCase();<br>  <span class="hljs-keyword">case</span> <span class="hljs-built_in">String</span> s                   -&gt; s.toLowerCase();<br><br>  <span class="hljs-keyword">case</span> Integer i                  -&gt; <span class="hljs-built_in">String</span>.valueOf(i * i);<br>  <br>  <span class="hljs-keyword">default</span> -&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;Unexpected value: &quot;</span> + obj);<br>&#125;;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>The case must <code>default</code>return a value, otherwise the return value of the <code>switch</code>expression could be undefined - or, as in the example, throw an exception.</p>
<h4 id="Completeness-check-with-Sealed-Classes"><a href="#Completeness-check-with-Sealed-Classes" class="headerlink" title="Completeness check with Sealed Classes"></a>Completeness check with Sealed Classes</h4><p>Incidentally, when using <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/sealed-classes-de/">sealed classes</a> , the compiler can check whether <code>switch</code>the statement or expression is complete. If that is the case, a <code>default</code>case is not needed.</p>
<p>This has an advantage that is not immediately apparent: if one day the sealed hierarchy is extended, the compiler will recognize the then incomplete <code>switch</code>expression and you will be forced to complete it. This saves you from making mistakes that go unnoticed.</p>
<p>“Pattern Matching for switch” will be presented again in <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-18-features-de/#Pattern_Matching_for_switch_Second_Preview">Java 18</a> as a preview feature and will probably be ready for production in Java 19.</p>
<h3 id="Foreign-Function-amp-Memory-API-Incubator"><a href="#Foreign-Function-amp-Memory-API-Incubator" class="headerlink" title="Foreign Function &amp; Memory API (Incubator)"></a>Foreign Function &amp; Memory API (Incubator)</h3><p>Since Java 1.1, the Java Native Interface (JNI) offers the possibility of calling native C code from within Java. However, JNI is extremely complex to implement and slow to run.</p>
<p>To create a JNI replacement, <a target="_blank" rel="noopener" href="https://openjdk.org/projects/panama/">Project Panama</a> was created. Concrete goals of this project are a) to simplify the effort of the implementation (90% of the work is to be eliminated) and b) to improve the performance (by a factor of 4 to 5).</p>
<p>In the last three Java versions, two new APIs have been introduced, each in the incubator stage:</p>
<ol>
<li>The Foreign Memory Access API (introduced in <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-14-features-de/#Foreign-Memory_Access_API_Incubator">Java 14</a> , refined in <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-15-features-de/#Foreign-Memory_Access_API_Second_Incubator">Java 15</a> and <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-16-features-de/#Foreign_Linker_API_Incubator_Foreign-Memory_Access_API_Third_Incubator">Java 16</a> ),</li>
<li>The Foreign Linker API (introduced in <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-16-features-de/#Foreign_Linker_API_Incubator_Foreign-Memory_Access_API_Third_Incubator">Java 16</a> ).</li>
</ol>
<p>JDK <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/412">Enhancement Proposal 412</a> combined both APIs in Java 17 into the “Foreign Function &amp; Memory API”.</p>
<p>This is still in the incubator stage, so it may still be subject to significant changes. <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-19-features/#Foreign_Function_Memory_API_Preview">I will introduce the new API in the Java 19</a> article when it reaches the preview stage.</p>
<h3 id="Vector-API-Second-Incubator"><a href="#Vector-API-Second-Incubator" class="headerlink" title="Vector API (Second Incubator)"></a>Vector API (Second Incubator)</h3><p><a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-16-features-de/#Vector_API_Incubator">As already described in the article about Java 16</a> , the Vector API is not about the old <code>java.util.Vector</code>class, but about mapping mathematical vector calculations to modern CPU architectures with single-instruction-multiple-data (SIMD) support.</p>
<p>JDK <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/414">Enhancement Proposal 414</a> improved performance and extended the API, e.g. B. to support <code>Character</code>(previously , <code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>and <code>Float</code>were <code>Double</code>supported).</p>
<p>Because features in Incubator status can still undergo significant changes, I’ll announce the feature when it reaches Preview status.</p>
<h2 id="Deprecations-and-Deletion"><a href="#Deprecations-and-Deletion" class="headerlink" title="Deprecations and Deletion"></a>Deprecations and Deletion</h2><p>In Java 17, some obsolete features were again marked as “deprecated for removal” or completely removed.</p>
<h3 id="Deprecate-the-Applet-API-for-Removal"><a href="#Deprecate-the-Applet-API-for-Removal" class="headerlink" title="Deprecate the Applet API for Removal"></a>Deprecate the Applet API for Removal</h3><p>Java applets are no longer supported by any modern web browser and were already marked as “deprecated” in Java 9.</p>
<p>JDK <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/398">Enhancement Proposal 398</a> marks them as “deprecated for removal” in Java 17. This means that they will be completely removed in one of the next releases.</p>
<h3 id="Deprecate-the-Security-Manager-for-Removal"><a href="#Deprecate-the-Security-Manager-for-Removal" class="headerlink" title="Deprecate the Security Manager for Removal"></a>Deprecate the Security Manager for Removal</h3><p>The Security Manager has been part of the platform since Java 1.0 and was primarily intended to protect the user’s computer and data from downloaded Java applets. These were launched in a sandbox in which the Security Manager generally denied access to resources such as the file system or the network.</p>
<p>As described in the previous section, Java applets have been marked as “deprecated for removal”; this aspect of the Security Manager will no longer be relevant.</p>
<p><em>In addition to the browser sandbox, which generally</em> denied access to resources , the Security Manager was also able to secure server applications using policy files. Elasticsearch and Tomcat are examples of this.</p>
<p>However, it’s not of much interest anymore because it’s complicated to configure and security can now be better implemented via the Java modular system or isolation through containerization.</p>
<p>In addition, the Security Manager represents a not inconsiderable amount of maintenance work. For all extensions to the Java class library, it must be evaluated to what extent they need to be secured using the Security Manager.</p>
<p>For these reasons, <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/411">JDK Enhancement Proposal 411</a> in Java 17 classified the Security Manager as “deprecated for removal”.</p>
<p>It is not yet certain when the Security Manager will be completely removed. In Java 18 it will still be included.</p>
<h3 id="Remove-RMI-Activation"><a href="#Remove-RMI-Activation" class="headerlink" title="Remove RMI Activation"></a>Remove RMI Activation</h3><p>Remote Method Invocation is a technology for invoking methods on “remote objects”, i.e. objects on another JVM.</p>
<p>RMI Activation allows objects destroyed on the target JVM to be automatically re-instantiated as soon as they are accessed. This is intended to eliminate the need for error handling on the client side.</p>
<p>However, RMI activation is relatively complex and results in ongoing maintenance costs; it’s also virtually unused, as analysis of open source projects and forums like StackOverflow have shown.</p>
<p>For this reason, RMI Activation was marked as “deprecated” in <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-15-features-de/#Deprecate_RMI_Activation_for_Removal">Java 15</a> and completely removed in Java 17 by <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/407">JDK Enhancement Proposal 407 .</a></p>
<h3 id="Remove-the-Experimental-AOT-and-JIT-Compiler"><a href="#Remove-the-Experimental-AOT-and-JIT-Compiler" class="headerlink" title="Remove the Experimental AOT and JIT Compiler"></a>Remove the Experimental AOT and JIT Compiler</h3><p>In Java 9, Graal was added to the JDK as an experimental ahead-of-time (AOT) compiler. In <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-10-features-de/#Experimental_Java-Based_JIT_Compiler">Java 10</a> , Graal was also made available as a just-in-time (JIT) compiler.</p>
<p>However, both features have been little used since then. Because the maintenance overhead is significant, Graal has been removed in the JDK 16 builds released by Oracle. Since nobody complained about this, both AOT and JIT compilers have been completely removed in Java 17 with <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/410">JDK Enhancement Proposal 410 .</a></p>
<p>The Java-Level JVM Compiler Interface (JVMCI) used to connect Graal has not been removed, and Graal itself is also being further developed. To use Graal as an AOT or JIT compiler, you can download the Java distribution <a target="_blank" rel="noopener" href="https://www.graalvm.org/">GraalVM</a> .</p>
<h2 id="Other-changes-in-Java-17"><a href="#Other-changes-in-Java-17" class="headerlink" title="Other changes in Java 17"></a>Other changes in Java 17</h2><p>In this section you will find minor changes to the Java class library that you will not come into contact with on a daily basis. Still, I recommend skimming through them at least once so you know where to look when you need a feature.</p>
<h3 id="New-API-for-Accessing-Large-Icons"><a href="#New-API-for-Accessing-Large-Icons" class="headerlink" title="New API for Accessing Large Icons"></a>New API for Accessing Large Icons</h3><p>Here is a small Swing application that renders the directory <code>C:\Windows</code>‘s filesystem icon on Windows:</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-keyword">File</span><span class="hljs-params">System</span>View <span class="hljs-keyword">file</span><span class="hljs-params">System</span>View = <span class="hljs-keyword">File</span><span class="hljs-params">System</span>View.getFile<span class="hljs-params">System</span>View()<span class="hljs-comment">;</span><br><span class="hljs-keyword">Icon</span> <span class="hljs-keyword">icon</span> = <span class="hljs-keyword">file</span><span class="hljs-params">System</span>View.get<span class="hljs-params">System</span><span class="hljs-keyword">Icon</span>(new <span class="hljs-keyword">File</span>(<span class="hljs-string">&quot;C:\\Windows&quot;</span>))<span class="hljs-comment">;</span><br><br>JFrame frame = new JFrame()<span class="hljs-comment">;</span><br>frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE)<span class="hljs-comment">;</span><br>frame.getContentPane().add(new JLabel(<span class="hljs-keyword">icon</span>))<span class="hljs-comment">;</span><br>frame.pack()<span class="hljs-comment">;</span><br>frame.setVisible(<span class="hljs-literal">true</span>)<span class="hljs-comment">;Code language:  Java  ( java )</span><br></code></pre></td></tr></table></figure>

<p>The icon has a size of 16 x 16 pixels, and there was no way to display a higher resolution icon.</p>
<p>In Java 17 the method was <code>getSystemIcon(File f, int width, int height)</code>added with which you can specify the size of the icon:</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-keyword">Icon</span> <span class="hljs-keyword">icon</span> = <span class="hljs-keyword">file</span><span class="hljs-params">System</span>View.get<span class="hljs-params">System</span><span class="hljs-keyword">Icon</span>(new <span class="hljs-keyword">File</span>(<span class="hljs-string">&quot;C:\\Windows&quot;</span>), <span class="hljs-number">512</span>, <span class="hljs-number">512</span>)<span class="hljs-comment">;Code language:  Java  ( java )</span><br></code></pre></td></tr></table></figure>

<p><em>There is no JDK Enhancement Proposal for this extension.</em></p>
<h3 id="Add-support-for-UserDefinedFileAttributeView-on-macOS"><a href="#Add-support-for-UserDefinedFileAttributeView-on-macOS" class="headerlink" title="Add support for UserDefinedFileAttributeView on macOS"></a>Add support for UserDefinedFileAttributeView on macOS</h3><p>The following code shows how extended attributes of a file can be written and read:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">Path path =<span class="hljs-operator"> ...</span><br><span class="hljs-operator"></span><br><span class="hljs-operator"></span>UserDefinedFileAttributeView view =<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Files</span>.</span></span>get<span class="hljs-constructor">FileAttributeView(<span class="hljs-params">path</span>, UserDefinedFileAttributeView.<span class="hljs-params">class</span>)</span>;<br><br><span class="hljs-comment">// Write the extended attribute with name &quot;foo&quot; and value &quot;bar&quot;</span><br>view.write(<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">StandardCharsets</span>.</span><span class="hljs-module"><span class="hljs-identifier">UTF_8</span>.</span></span>encode(<span class="hljs-string">&quot;bar&quot;</span>));<br><br><span class="hljs-comment">// Print a list of all extended attribute names</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;attribute names: &quot;</span> + view.<span class="hljs-built_in">list</span><span class="hljs-literal">()</span>);<br><br><span class="hljs-comment">// Read the extended attribute &quot;foo&quot;</span><br>ByteBuffer byteBuffer = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ByteBuffer</span>.</span></span>allocate(<span class="hljs-number">1024</span>);<br>view.read(<span class="hljs-string">&quot;foo&quot;</span>, byteBuffer);<br>byteBuffer.flip<span class="hljs-literal">()</span>;<br>String value = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">StandardCharsets</span>.</span><span class="hljs-module"><span class="hljs-identifier">UTF_8</span>.</span></span>decode(byteBuffer).<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;value of &#x27;foo&#x27;: &quot;</span> + value);Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>This functionality has existed since Java 7, but was not previously supported on macOS either. Since Java 17, the function is now also available for macOS.</p>
<p><em>There is no JDK Enhancement Proposal for this extension.</em></p>
<h3 id="System-Property-for-Native-Character-Encoding-Name"><a href="#System-Property-for-Native-Character-Encoding-Name" class="headerlink" title="System Property for Native Character Encoding Name"></a>System Property for Native Character Encoding Name</h3><p>As of Java 17, the system property “native.encoding” can be used to call up the standard character encoding of the operating system:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;native encoding: &quot; + <span class="hljs-keyword">System</span>.getProperty(&quot;native.encoding&quot;));Code <span class="hljs-keyword">language</span>:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>On Windows it <code>Cp1252</code>outputs , on Linux and macOS <code>UTF-8</code>.</p>
<p>If you call this code with Java 16 or earlier, is <code>null</code>output.</p>
<p><em>There is no JDK Enhancement Proposal for this extension.</em></p>
<h3 id="Restore-Always-Strict-Floating-Point-Semantics"><a href="#Restore-Always-Strict-Floating-Point-Semantics" class="headerlink" title="Restore Always-Strict Floating-Point Semantics"></a>Restore Always-Strict Floating-Point Semantics</h3><p>An almost unknown Java keyword is <code>strictfp</code>. It is used in class definitions to make floating point operations strict within a class. This means that they lead to the same, predictable results on all architectures.</p>
<p>Strict floating-point semantics was the default behavior prior to Java 1.2 (that is, more than 20 years ago).</p>
<p>As of Java 1.2, the “standard floating point semantics” was used by default, which could lead to slightly different results depending on the processor architecture. On the other hand, it performed better on the x87 floating-point coprocessor that was widespread at the time, since it had to perform additional operations for the strict semantics (you can find more details in this <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Strictfp">Wikipedia article</a> ).</p>
<p>Starting with Java 1.2, anyone who wanted to continue to use strict calculations had to <code>strictfp</code>mark this with the keyword in the class definition:</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> strictfp <span class="hljs-keyword">class</span> <span class="hljs-symbol">PredictiveCalculator</span> &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br>Code language:  Java  ( java )<br></code></pre></td></tr></table></figure>

<p>Modern hardware can carry out the strict floating-point semantics without any loss of performance, so that in <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/306">JDK Enhancement Proposal 306</a> it was decided to make this the standard semantics again from Java 17.</p>
<p>The <code>strictfp</code>keyword is therefore superfluous. Using it results in a compiler warning:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ javac PredictiveCalculator.java<br>PredictiveCalculator.java:<span class="hljs-number">3</span>: <span class="hljs-built_in">warning</span>: [strictfp] <span class="hljs-keyword">as</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">release</span> <span class="hljs-number">17</span>, <br><span class="hljs-keyword">all</span> floating-<span class="hljs-type">point</span> expressions are evaluated strictly <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;strictfp&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> required<br>Code <span class="hljs-keyword">language</span>:  Plaintext  ( plaintext )<br></code></pre></td></tr></table></figure>

<h3 id="New-macOS-Rendering-Pipeline"><a href="#New-macOS-Rendering-Pipeline" class="headerlink" title="New macOS Rendering Pipeline"></a>New macOS Rendering Pipeline</h3><p>In 2018, Apple marked the OpenGL library previously used by Java Swing for rendering under macOS as “deprecated” and presented the <a target="_blank" rel="noopener" href="https://developer.apple.com/metal/">Metal framework</a> as its successor.</p>
<p><a target="_blank" rel="noopener" href="https://openjdk.org/jeps/382">JDK Enhancement Proposal 382</a> transitions the Swing rendering pipeline for macOS to the Metal API.</p>
<h3 id="macOS-x2F-AArch64-Port"><a href="#macOS-x2F-AArch64-Port" class="headerlink" title="macOS&#x2F;AArch64 Port"></a>macOS&#x2F;AArch64 Port</h3><p>Apple has announced that it will switch Macs from x64 to AArch64 CPUs in the long term. Accordingly, a corresponding port is provided with <a target="_blank" rel="noopener" href="https://openjdk.org/jeps/391">JDK Enhancement Proposal 391 .</a></p>
<p>The code is an extension of the AArch64 ports for Linux and Windows released in Java 9 and <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-16-features-de/#WindowsAArch64_Port">Java 16 with macOS-specific adjustments.</a></p>
<h3 id="New-Page-for-“New-API”-and-Improved-“Deprecated”-Page"><a href="#New-Page-for-“New-API”-and-Improved-“Deprecated”-Page" class="headerlink" title="New Page for “New API” and Improved “Deprecated” Page"></a>New Page for “New API” and Improved “Deprecated” Page</h3><p>In JavaDoc generated from Java 17, there is a “NEW” page that shows all new features grouped by version. To do this, the <code>@since</code>tags of the modules, packages, classes, etc. are evaluated.</p>
<p><img src="https://www.happycoders.eu/wp-content/uploads/2021/12/javadoc_since_java_17-800x503.png" srcset="/images/loading.gif" lazyload alt="&quot;NEW&quot; page in JavaDoc generated since Java 17"></p>
<p>“NEW” page in JavaDoc generated since Java 17</p>
<p>In addition, the “DEPRECATED” page has been revised. Up until Java 16, here is an ungrouped list of all features marked as “deprecated”:</p>
<p><img src="https://www.happycoders.eu/wp-content/uploads/2021/12/javadoc_deprecated_java_16-800x435.png" srcset="/images/loading.gif" lazyload alt="Java 16 DEPRECATED page"></p>
<p>Java 16 DEPRECATED page</p>
<p>Starting with Java 17, we see the features marked as “deprecated” grouped by release:</p>
<p><img src="https://www.happycoders.eu/wp-content/uploads/2021/12/javadoc_deprecated_java_17-800x460.png" srcset="/images/loading.gif" lazyload alt="Java 17 DEPRECATED page"></p>
<p>Java 17 DEPRECATED page</p>
<p><em>There is no JDK Enhancement Proposal for this extension.</em></p>
<h3 id="Complete-list-of-all-changes-in-Java-17"><a href="#Complete-list-of-all-changes-in-Java-17" class="headerlink" title="Complete list of all changes in Java 17"></a>Complete list of all changes in Java 17</h3><p>This article has presented all changes defined in JDK Enhancement Proposals (JEPs) as well as numerous class library extensions for which no JEPs exist. For more changes, especially to the security libraries, see the <a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/17-relnote-issues.html">official Java 17 release notes</a> .</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Although Java 17 is the latest LTS release, this release is not significantly different from the previous ones. We got a mix of:</p>
<ul>
<li>new language features (sealed classes),</li>
<li>API changes ( <code>InstantSource</code>, <code>HexFormat</code>, context-specific deserialization filters),</li>
<li>a performance improvement (asynchronous logging of the JVM),</li>
<li>Deprecations and deletions (Applet API, Security Manager, RMI Activation, AOT and JIT Compiler)</li>
<li>und neuen Preview- und Incubator-Features (Pattern Matching for switch, Foreign Function &amp; Memory API, Vector API).</li>
</ul>
<p>In addition, the path taken in Java 9 with Project Jigsaw has been brought to an end by removing the transitionally provided “Relaxed Strong Encapsulation” mode and access to private members of other modules (deep reflection) must always be explicitly released.</p>
<p>Did you like the article? Then please leave me a comment or share the article using one of the share buttons at the end.</p>
<p><a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-18-features-de/">Java 18</a> is just around the corner and the features it contains are certain. I will present these in the next article. Would you like to be informed when the article goes online? Then <a target="_blank" rel="noopener" href="https://www.happycoders.eu/de/java/java-17-features-de/#">click here</a> to sign up for the HappyCoders newsletter.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>What&#39;s new in Java 17</div>
      <div>https://java-springboot-kafka.github.io/2022/11/13/what_is_new_in_java_17/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Mehrdad Karami</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>November 13, 2022</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/11/13/virtual-threads-in-java-19/" title="Virtual Threads in Java 19">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Virtual Threads in Java 19</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/11/13/kafka-streams-and-spring-boot/" title="Spring Boot and Kafka Stream, Processing continuous data streams">
                        <span class="hidden-mobile">Spring Boot and Kafka Stream, Processing continuous data streams</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    

  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        Views: 
        <span id="busuanzi_value_site_pv"></span>
        
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        Visitors: 
        <span id="busuanzi_value_site_uv"></span>
        
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
